---
name: codex-cli-delegation
description: 코드 리뷰(/review), 샌드박스 실행, 웹 검색+코딩, 수학/논리 추론, 병렬 에이전트, CI 자동화 등 Codex CLI 특화 작업을 위임하는 패턴. PR 리뷰, 코드 실행 검증, 외부 정보 기반 코딩, 논리적 정합성 검증 작업 시 사용.
---

# Codex CLI 위임 패턴

## 1. 개요

### Codex CLI란?
OpenAI의 터미널 기반 AI 코딩 에이전트. GPT-5.2-Codex 모델 기반으로 코드 리뷰, Landlock 커널 레벨 샌드박스 실행, 웹 검색 연동 코딩, 병렬 에이전트 처리가 가능하다.

### 왜 위임하는가?
- **전용 /review 명령어**: intent-to-diff 매칭 + 전체 코드베이스 추론 (일반 프롬프트보다 정밀)
- **Landlock 샌드박스**: 커널 레벨 격리 실행으로 안전한 코드 검증
- **웹 검색 연동**: `--search` 플래그로 최신 정보 + 코딩 결합
- **수학/추상 추론**: AIME 100%, ARC-AGI-2 54.2% (Claude 37.6%)
- **400K 컨텍스트 + 128K 출력**: Claude보다 넓은 컨텍스트와 장문 생성
- **codex exec**: 비대화형 자동화로 CI/CD 파이프라인 연동

### Claude 대비 Codex (GPT 5.2) 강점 (벤치마크 기준)

| 영역 | Codex (GPT 5.2) | Claude | 차이 |
|------|-----------------|--------|------|
| 수학 추론 (AIME 2025) | **100%** (최초 만점) | ~92.8% | +7.2pp |
| 추상 추론 (ARC-AGI-2) | **52.9-54.2%** | 37.6% | +15pp |
| 전문 지식 (GDPval) | **70.9%** | - | Codex 우위 |
| 비전 (MMMU-Pro) | **86.5%** | - | Codex 우위 |
| 컨텍스트 윈도우 | **400K** | 200K | 2배 |
| 최대 출력 | **128K 토큰** | ~8K | 16배 |
| SWE-bench Verified | 80.0% | **80.9%** | Claude 근소 우위 |
| 정밀 코드 작성 | 좋음 | **최적** | Claude 우위 |
| 지시 따르기 | 좋음 | **최적** | Claude 우위 |

### Gemini CLI와의 역할 분담

| 특성 | Gemini CLI | Codex CLI |
|------|-----------|-----------|
| 핵심 강점 | 대규모 컨텍스트 (1M 토큰), 멀티모달 | 코드 리뷰, 샌드박스 실행, 수학 추론 |
| 주요 용도 | 10+ 파일 분석, 아키텍처 파악 | PR 리뷰, 실행 테스트, 논리 검증 |
| 파일 수정 | 읽기 전용 분석 권장 | 샌드박스 내 실행 가능 |
| 실행 환경 | 네트워크 필요 | 로컬 Landlock 샌드박스 + 네트워크 |

---

## 2. 사전 확인

### 설치 여부 확인
```bash
# macOS/Linux
which codex 2>/dev/null && echo "AVAILABLE" || echo "NOT_AVAILABLE"

# Windows
where codex 2>nul && echo "AVAILABLE" || echo "NOT_AVAILABLE"
```

### Fallback 전략
Codex CLI 미설치 시 Claude가 직접 수행:

| 원래 작업 | Fallback 방법 | 품질 영향 |
|----------|--------------|----------|
| /review 코드 리뷰 | `git diff` + `git log` 출력을 Claude가 직접 분석 | 중간 (intent 매칭 불가) |
| 샌드박스 실행 | 실행 불가, 코드 흐름 추적 및 설명만 제공 | 높음 (실행 검증 불가) |
| 웹 검색 + 코딩 | Claude의 WebSearch 도구 사용 | 낮음 (대부분 동등) |
| 수학/논리 추론 | Claude가 직접 추론 | 중간 (AIME 92.8% vs 100%) |
| codex exec (CI) | 대체 불가, 수동 실행 안내 | 높음 |

---

## 3. 위임 판단 기준

### 코드 리뷰 시나리오 (강화)

| 시나리오 | 트리거 조건 | 예시 |
|---------|-----------|------|
| PR/커밋 코드 리뷰 | PR이나 커밋의 diff 리뷰 요청 | "최근 커밋 코드 리뷰해줘" |
| **전용 /review 사용** | 의도-diff 매칭이 필요한 리뷰 | "이 PR이 목적대로 구현됐는지 확인해줘" |
| **보안 중심 리뷰** | 보안 취약점 집중 검토 | "이 변경에 보안 문제 없는지 리뷰해줘" |
| **성능 중심 리뷰** | 성능 이슈 집중 검토 | "이 변경이 성능에 영향 없는지 확인해줘" |

### 실행/검증 시나리오

| 시나리오 | 트리거 조건 | 예시 |
|---------|-----------|------|
| 코드 실행 검증 | 코드 변경 후 실행 결과 확인 필요 | "이 스크립트가 정상 실행되는지 확인해줘" |
| 테스트 실행+분석 | 테스트 실패 원인 분석 | "테스트 실행하고 실패 원인 분석해줘" |
| 자동 버그 수정 | 간단한 버그의 자동 수정 | "이 테스트 실패 원인 찾아서 고쳐줘" |

### 웹 검색 시나리오

| 시나리오 | 트리거 조건 | 예시 |
|---------|-----------|------|
| 웹 정보 기반 코딩 | 외부 API 문서/라이브러리 참조 필요 | "최신 Next.js 15 패턴으로 변경해줘" |
| CVE 검색 | 사용 패키지 보안 취약점 확인 | "FastAPI 최신 CVE 확인해줘" |
| 최신 모범 사례 | 프레임워크 최신 패턴 확인 | "LanceDB 0.x 최신 API 변경점 확인해줘" |

### 수학/논리 추론 시나리오 (GPT 5.2 신규)

| 시나리오 | 트리거 조건 | 예시 |
|---------|-----------|------|
| 통계 알고리즘 검증 | 수학적 정확성 확인 필요 | "밀도 계산 수식이 수학적으로 맞는지 검증해줘" |
| 논리적 정합성 검증 | 비즈니스 규칙의 논리 검증 | "이 할인율 계산 로직에 논리적 오류 없는지 확인" |
| 복잡한 조건 분기 | 조건문 조합의 완전성 검증 | "이 라우팅 규칙이 모든 케이스를 커버하는지 확인" |

### 자동화 시나리오 (GPT 5.2 신규)

| 시나리오 | 트리거 조건 | 예시 |
|---------|-----------|------|
| CI 파이프라인 연동 | 자동화된 리뷰/검증 필요 | GitHub Actions에서 `codex exec` 실행 |
| 비대화형 작업 | 스크립트에서 자동 호출 | `codex exec "린트 결과 분석하고 수정해줘"` |
| 배치 리뷰 | 여러 PR 순차 리뷰 | for loop으로 `codex exec` 반복 |

### 위임하지 않는 경우
- 단일 파일의 간단한 수정
- Claude가 직접 수행 가능한 간단한 분석 작업
- 민감한 파일을 다루는 작업
- Codex CLI 미설치 환경

---

## 4. 명령어 패턴

### 승인 정책 (Approval Policy)

Codex CLI는 3단계 승인 정책을 제공합니다:

| 모드 | 플래그 | 설명 | 권장 사용 상황 |
|------|-------|------|---------------|
| **Suggest** | (기본값) | 모든 변경에 승인 필요 | 처음 사용 시, 민감 코드 |
| **Auto Edit** | `--auto-edit` | 파일 수정 자동, 명령 실행은 승인 | 코드 수정 작업 |
| **Full Auto** | `--full-auto` | 모든 작업 자동 승인 | 신뢰할 수 있는 반복 작업 |

> **주의**: `--full-auto`는 신뢰할 수 있는 작업에만 사용합니다.

### 기본 사용법

```bash
# 대화형 모드 (기본)
codex

# 비대화형 모드 (프롬프트 직접 전달)
codex "프롬프트 내용"

# 출력만 (quiet 모드)
codex -q "프롬프트 내용"

# 모델 지정
codex --model o4-mini "프롬프트 내용"

# 웹 검색 활성화
codex --search "프롬프트 내용"
```

### 전용 /review 명령어 (GPT 5.2 강화)

```bash
# 기본 리뷰 (staged + unstaged + untracked)
codex /review

# 특정 베이스 브랜치 기준 리뷰
codex /review --base main

# 보안 중심 리뷰
codex /review --instructions "보안 취약점에 집중해서 리뷰해줘. SQL 인젝션, XSS, 인증 우회를 중점 확인"

# 성능 중심 리뷰
codex /review --instructions "성능 이슈에 집중해줘. N+1 쿼리, 불필요한 루프, 메모리 누수를 확인"

# 프로젝트 규칙 준수 리뷰
codex /review --instructions "프로젝트 코딩 규칙(타입 힌트 필수, 함수 30줄 이하, snake_case) 준수 여부를 확인"
```

> **핵심**: `/review`는 단순 diff 분석이 아니라, **PR의 의도(intent)와 실제 변경(diff)이 일치하는지** 전체 코드베이스를 참조하여 추론합니다. 일반 프롬프트 리뷰보다 정밀합니다.

### 코드 리뷰 패턴 (프롬프트 방식)

```bash
# 최근 커밋 리뷰
codex "최근 커밋의 코드 변경사항을 리뷰해줘. 버그, 보안 취약점, 코드 품질 문제를 지적해줘."

# 특정 커밋 리뷰
codex "다음 커밋을 리뷰해줘: $(git log --oneline -1 HEAD). 변경된 코드의 품질, 보안, 성능 이슈를 분석해줘."

# PR 리뷰 (GitHub CLI 연동)
codex "$(gh pr diff 123) 이 PR의 변경사항을 리뷰해줘. 주요 변경점과 개선 제안을 정리해줘."

# staged 변경 리뷰
codex "$(git diff --cached) 이 변경사항을 리뷰해줘. 커밋 전 검토 항목을 알려줘."
```

### 샌드박스 실행 패턴

```bash
# 읽기 전용 샌드박스 (네트워크 비활성) — Landlock 커널 레벨 격리
codex --full-auto --sandbox read-only "tests/ 디렉토리의 테스트를 실행하고 결과를 알려줘"

# 쓰기 허용 샌드박스 (작업 디렉토리만)
codex --full-auto --sandbox workspace-write "이 스크립트를 실행하고 출력 파일을 확인해줘"

# 네트워크 허용 샌드박스
codex --full-auto --sandbox network "이 API 엔드포인트를 호출하고 응답을 확인해줘"
```

### 웹 검색 연동 패턴

```bash
# 최신 문서 기반 코딩 (--search 플래그)
codex --search "Next.js 15의 최신 Server Actions 패턴을 검색하고, 우리 프로젝트에 적용할 수 있는 코드를 작성해줘"

# 라이브러리 마이그레이션
codex --search "Pydantic v2 마이그레이션 가이드를 검색하고, backend/app/modules/ 에 적용할 변경점을 정리해줘"

# 보안 취약점 검색
codex --search "최신 FastAPI 보안 취약점 CVE를 검색하고, 우리 프로젝트에 해당하는 항목을 확인해줘"
```

### 수학/논리 추론 패턴 (GPT 5.2 신규)

```bash
# 통계 수식 검증
codex "이 변호사 밀도 계산 함수의 수학적 정확성을 검증해줘. 공식: (변호사수 / 인구) * 100000"

# 조건 분기 완전성 검증
codex "이 라우팅 규칙(backend/app/multi_agent/routing/)의 모든 조건 분기가 빈틈없이 커버되는지 검증해줘"

# 비즈니스 규칙 논리 검증
codex "이 소액소송 가이드의 단계별 조건 분기에 논리적 모순이 없는지 확인해줘"
```

### 비대화형 자동화 패턴 (GPT 5.2 신규)

```bash
# codex exec — CI/CD 파이프라인용 비대화형 실행
codex exec "린트 결과를 분석하고 자동 수정 가능한 항목을 수정해줘"

# 배치 리뷰 (여러 커밋)
for commit in $(git log --oneline -5 --format=%H); do
  codex exec "커밋 $commit 을 리뷰하고 결과를 출력해줘"
done

# GitHub Actions 연동 예시
# codex exec "$(gh pr diff $PR_NUMBER) 이 PR을 리뷰하고 결과를 JSON으로 출력해줘"
```

### stdin 파이핑 패턴

```bash
# diff를 파이프로 전달
git diff HEAD~3..HEAD | codex "이 변경사항들의 코드 리뷰를 수행해줘"

# 테스트 결과 전달
uv run pytest --tb=short 2>&1 | codex "실패한 테스트의 원인을 분석하고 수정 방법을 제안해줘"
```

---

## 5. 결과 활용 방법

### 기본 흐름
1. Codex CLI로 리뷰/분석/실행 수행
2. 출력 결과를 Claude가 수신
3. **결과 검증** (파일 경로, 함수명 존재 여부 등)
4. 검증된 결과를 기반으로 코드 수정 또는 보고

### /review 결과 활용 (신규)
```
1. codex /review 실행
2. intent-to-diff 매칭 결과 수신
3. 지적된 파일/라인 실제 존재 확인 (Read 도구)
4. 우선순위별 정렬 (Critical > High > Medium > Low)
5. Claude가 실제 코드 수정 수행
6. 수정 후 검증 (lint, type check)
```

### 코드 리뷰 결과 활용
```
1. Codex CLI 리뷰 결과 수신
2. 지적된 파일/라인 실제 존재 확인 (Read 도구)
3. 유효한 지적사항만 필터링
4. Claude가 실제 코드 수정 수행
5. 수정 후 검증 (lint, type check)
```

### 실행 결과 활용
```
1. Codex CLI 실행 결과 수신
2. 에러 발생 시 원인 분석
3. Claude가 수정 코드 작성
4. 수정 후 재검증 (가능한 경우)
```

---

## 6. 주의사항

### 보안 규칙
- **민감 파일 전달 금지**: `.env`, `credentials.json`, `*.pem`, `*.key` 등
- **API 키 노출 금지**: 환경 변수로 관리되는 비밀 값을 프롬프트에 포함하지 않음
- `--full-auto` 모드는 민감 코드 수정에 사용 금지

### 실행 규칙
- **읽기 전용 분석 우선**: 코드 수정은 Claude가 담당, Codex는 분석/리뷰 용도
- **샌드박스 모드 활용**: 실행이 필요한 경우 반드시 샌드박스 내에서 수행
- **네트워크 접근 최소화**: 필요한 경우에만 `--sandbox network` 사용
- **/review 우선**: 코드 리뷰 시 일반 프롬프트보다 `/review` 전용 명령어 우선 사용

### 결과 검증 규칙
- Codex CLI 출력은 반드시 Claude가 검증 (오탐, 오류 가능)
- 존재하지 않는 파일/함수를 언급한 경우 제거
- 보안 취약점 지적은 실제 코드에서 재확인
- 수정 제안은 프로젝트 코딩 규칙(`coding-style.md`)에 맞는지 확인

### 에러 처리
```
1. Codex CLI 실행 실패 → Fallback으로 전환
2. 타임아웃 발생 → 작업 범위 축소 후 재시도
3. 네트워크 오류 → 로컬 분석으로 전환
4. 인증 실패 → 사용자에게 설정 확인 안내
```

---

## 7. Fallback 상세 패턴

### 코드 리뷰 Fallback

Codex CLI 없이 Claude가 직접 코드 리뷰를 수행하는 패턴:

```bash
# 1. 변경 내역 확인
git log --oneline -10
git diff HEAD~1..HEAD --stat
git diff HEAD~1..HEAD

# 2. 변경된 파일 읽기 (Read 도구 사용)
# 3. 변경 사항 분석 및 리뷰 코멘트 작성
```

### 웹 검색 Fallback

Codex CLI 없이 Claude의 WebSearch 도구로 대체:

```
1. WebSearch 도구로 관련 정보 검색
2. WebFetch 도구로 공식 문서 확인
3. 검색 결과를 기반으로 코드 작성
```

### 샌드박스 실행 Fallback

실행 불가 시 Claude가 제공하는 대안:

```
1. 코드 흐름을 정적으로 추적하여 예상 결과 설명
2. 잠재적 에러 지점 표시
3. 사용자에게 직접 실행 방법 안내
4. 필요 시 테스트 코드 작성으로 대체
```

### 수학/논리 추론 Fallback (신규)

```
1. Claude가 직접 논리 추론 수행 (AIME ~92.8% 수준)
2. 단순한 수식 검증은 Claude로 충분
3. 복잡한 수학 증명이나 조합 문제는 정확도 한계 안내
```

---

## 8. Gemini CLI와의 병렬 사용

두 CLI를 함께 사용하는 패턴은 `.claude/skills/multi-cli-integration/SKILL.md` 참조.

### 간단한 조합 예시

| 시나리오 | Gemini CLI 역할 | Codex CLI 역할 | Claude 역할 |
|---------|----------------|---------------|------------|
| 보안 감사 | 전체 코드 스캔 | CVE 검색 + /review | 결과 통합, 수정 |
| 리팩토링 | 아키텍처 분석 | 변경 후 /review | 코드 작성 |
| PR 작성 | 영향 분석 | /review 리뷰 | PR 본문 작성 |
| 논리 검증 | 멀티홉 추론 (Deep Think) | 수학 검증 (AIME) | 결과 통합 |
